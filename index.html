<<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ENT</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(to right, #0f2027, #203a43, #2c5364);
      color: white;
      display: flex;
    }
    nav {
      width: 220px;
      background-color: #111;
      height: 100vh;
      display: flex;
      flex-direction: column;
      padding: 1rem;
      box-sizing: border-box;
    }
    nav a {
      color: cyan;
      margin-bottom: 1rem;
      text-decoration: none;
    }
    main {
      flex-grow: 1;
      padding: 2rem;
    }
    .hidden {
      display: none;
    }
    .box {
      background: rgba(255, 255, 255, 0.1);
      padding: 1rem;
      border-radius: 10px;
      margin-bottom: 2rem;
    }
    input, select, textarea, button {
      margin-top: 0.5rem;
      display: block;
      width: 100%;
      padding: 0.5rem;
      border-radius: 5px;
      border: none;
    }
    button {
      background-color: #00bcd4;
      color: white;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <nav>
    <h3 id="roleTitle">ENT</h3>
    <a href="#actualites">Actualités</a>
    <a href="#messagerie">Messagerie</a>
    <a href="#fichiers">Fichiers</a>
    <a href="#ressources">Ressources</a>
    <a href="#pronote" onclick="window.open('https://0694174a.ac-jeanmoulin.fr/', '_blank')">Pronote</a>
    <a href="#administration">Administration</a>
  </nav>
  <main>
    <div id="actualites" class="box">
      <h2>Actualités</h2>
      <textarea placeholder="Nouvelle actu..."></textarea>
      <button>Ajouter</button>
    </div>

    <div id="messagerie" class="box hidden">
      <h2>Messagerie</h2>
      <select id="destinataire">
        <option value="">Choisir destinataire</option>
        <option value="prof1">Professeur 1</option>
        <option value="dir1">Direction</option>
        <option value="eleve1">Élève 1</option>
      </select>
      <textarea id="messageInput" placeholder="Votre message..."></textarea>
      <button onclick="envoyerMessage()">Envoyer</button>

      <h3>Messages reçus :</h3>
      <div id="messagesReçus"></div>
    </div>

    <div id="fichiers" class="box hidden">
      <h2>Fichiers privés</h2>
      <label for="compteFichiers" style="font-weight:600; margin-bottom:0.4rem; display:block; color:#00bcd4;">Voir fichiers du compte :</label>
      <select id="compteFichiers">
        <option value="">-- Choisir un compte --</option>
        <option value="jrobert">JROBERT (direction)</option>
        <option value="prof1">Professeur 1</option>
        <option value="eleve1">Élève 1</option>
      </select>
      <div style="margin-top:1rem;">
        <input type="file" id="fileInput" multiple />
      </div>
      <h3 style="margin-top:1.5rem; color:#00bcd4;">Fichiers uploadés :</h3>
      <ul id="fileList" style="list-style:none; padding-left:0; max-height: 250px; overflow-y:auto; border: 1px solid #00bcd4; border-radius:6px; background: rgba(0,0,0,0.2);"></ul>
    </div>

    <div id="ressources" class="box hidden">
      <h2>Ressources Enseignants</h2>
      <input type="file" />
    </div>

    <div id="administration" class="box hidden">
      <h2>Comptes</h2>
      <ul>
        <li>JROBERT (direction)</li>
        <li>prof1 (enseignant)</li>
        <li>eleve1 (élève)</li>
      </ul>
      <h3>Créer un compte</h3>
      <input placeholder="Identifiant" />
      <input placeholder="Mot de passe" type="password" />
      <select>
        <option value="eleve">Élève</option>
        <option value="prof">Professeur</option>
        <option value="dir">Direction</option>
      </select>
      <button>Créer</button>
    </div>
  </main>

  <script>
    const sections = document.querySelectorAll('main > div');
    document.querySelectorAll('nav a').forEach(link => {
      link.addEventListener('click', e => {
        e.preventDefault();
        const id = link.getAttribute('href').substring(1);
        sections.forEach(s => s.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
      });
    });

    // Affiche la page Actualités par défaut
    document.getElementById('actualites').classList.remove('hidden');

    // Simule des messages reçus
    const messagesReçus = [
      { from: 'prof1', text: 'Travail à faire pour demain.' },
      { from: 'dir1', text: 'Réunion mardi à 10h.' }
    ];

    const container = document.getElementById('messagesReçus');
    messagesReçus.forEach(msg => {
      const div = document.createElement('div');
      div.innerHTML = `<strong>${msg.from}:</strong> ${msg.text}<br><textarea placeholder='Répondre...'></textarea><button onclick='alert("Réponse envoyée")'>Répondre</button>`;
      container.appendChild(div);
    });

    function envoyerMessage() {
      const dest = document.getElementById('destinataire').value;
      const text = document.getElementById('messageInput').value;
      if (!dest || !text) return alert("Veuillez compléter tous les champs.");
      alert("Message envoyé à " + dest);
    }

    // === Gestion fichiers uploadés par compte ===
    const compteFichiersSelect = document.getElementById('compteFichiers');
    const fileInput = document.getElementById('fileInput');
    const fileList = document.getElementById('fileList');

    // Objet pour stocker les fichiers uploadés par compte
    // Structure : { compteId: [ {name, blob}, ... ] }
    const fichiersParCompte = {};

    // Met à jour la liste des fichiers affichés pour le compte sélectionné
    function majListeFichiers() {
      const compte = compteFichiersSelect.value;
      fileList.innerHTML = '';
      if (!compte || !fichiersParCompte[compte] === undefined || fichiersParCompte[compte].length === 0) {
        fileList.innerHTML = '<li style="color:#ccc; padding: 0.5rem;">Aucun fichier</li>';
        return;
      }
      fichiersParCompte[compte].forEach((fichier, i) => {
        const li = document.createElement('li');
        li.style.padding = '0.5rem 1rem';
        li.style.borderBottom = '1px solid rgba(0,188,212,0.3)';
        // Création d'un lien de téléchargement Blob
        const url = URL.createObjectURL(fichier.blob);
        li.innerHTML = `<a href="${url}" download="${fichier.name}" style="color:#00e5ff; text-decoration:none;">${fichier.name}</a>`;
        fileList.appendChild(li);
      });
    }

    // Upload les fichiers sélectionnés dans le compte choisi
    fileInput.addEventListener('change', () => {
      const compte = compteFichiersSelect.value;
      if (!compte) {
        alert("Veuillez d'abord choisir un compte.");
        fileInput.value = '';
        return;
      }
      if (!fichiersParCompte[compte]) {
        fichiersParCompte[compte] = [];
      }
      for (const file of fileInput.files) {
        fichiersParCompte[compte].push({ name: file.name, blob: file });
      }
      fileInput.value = '';
      majListeFichiers();
    });

    // Quand on change de compte, on affiche la liste associée
    compteFichiersSelect.addEventListener('change', majListeFichiers);

    // Initialisation
    majListeFichiers();

  </script>
</body>
</html>
